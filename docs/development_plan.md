# План разработки веб-приложения PW Tactics

Данный документ описывает этапы разработки интерактивной карты для планирования тактики на ГВГ и МТВ в Perfect World.

## 1. Подготовка и проектирование
- [ ] Определение окончательного стека технологий (Frontend: React (Next.js) + Konva.js, Backend: Node.js + Socket.io + Redis/MongoDB).
- [ ] Структурирование графических ассетов (карты ГВГ/МТВ, иконки классов, зданий, катапульт).
- [ ] Проектирование схемы данных для хранения тактики (включая этапы, временные метки, состав отрядов и логику "выделения" персонажей из групп).
- [ ] Разработка Docker-конфигурации (Dockerfile, docker-compose.yml).

## 2. Разработка Backend
- [ ] Создание базового сервера на Node.js/Express.
- [ ] Реализация механизма создания комнат (UUID) и управления ролями ("Ведущий", "Все").
- [ ] Интеграция Socket.io для real-time синхронизации объектов, рисунков и состояний таймера (с изоляцией по этапам).
- [ ] Логика сервеной фильтрации событий: пользователи получают обновления только для того этапа, на котором находятся.
- [ ] Реализация API для сохранения/загрузки тактик (экспорт/импорт JSON).
- [ ] Логика автоматического удаления неактивных комнат (через 7 дней).

## 3. Разработка Frontend (Ядро и Инструменты)
- [ ] Настройка проекта (React/Next.js, Tailwind CSS).
- [ ] Реализация бесконечного холста с Zoom и Pan (Konva.js).
- [ ] Инструменты рисования: Карандаш, Линии, Фигуры (круги, области), Стрелки.
- [ ] Инструмент "Ластик" и система Undo/Redo для действий пользователя.
- [ ] Система текстовых меток с возможностью редактирования.
- [ ] Реализация тултипов (Hover) для иконок отрядов: отображение иконок классов + ников.
- [ ] Функционал "Выделения" (Detachment): возможность временно отсоединить персонажа или группу из отряда для отдельной задачи.
- [ ] Визуальное отображение связей между основным отрядом и "выделенными" членами.

## 4. Синхронизация и UI
- [ ] Связка фронтенда с сокетами: отправка перемещений и получение обновлений.
- [ ] Реализация системы "Этапов" (Stages): создание, переключение и именование этапов тактики.
- [ ] Изоляция состояния: изменения на одном этапе не отображаются на других до переключения.
- [ ] Интерфейс управления комнатой (поделиться ссылкой, очистить карту).
- [ ] Панель выбора объектов (иконки классов, метки, катапульты).
- [ ] Система слоев (показать/скрыть определенные группы объектов).

## 5. Планирование во времени (Timeline)
- [ ] Разработка компонента временной шкалы (Timeline).
- [ ] Логика привязки состояния объектов к временным меткам (Keyframes).
- [ ] Механика временных задач: автоматическое объединение выделенных персонажей с отрядом по завершении временного интервала/этапа.
- [ ] Реализация плеера для просмотра "движения" тактики во времени.
- [ ] Синхронизация таймера между всеми участниками комнаты.

## 6. Деплой и тестирование
- [ ] Настройка CI/CD.
- [ ] Деплой на хостинг (например, Vercel/Netlify для фронта и VPS для бэкенда).
- [ ] Нагрузочное тестирование системы сокетов.
